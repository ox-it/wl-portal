##
## the Site Tabs part of the standard view
##
##
#if ( ${pageColumn0Tools} ) 
  #foreach ( $tool in $pageColumn0Tools ) 
    #if ( $tool.breadcrumbs ) 
       #set ($portalBreadCrumbs = $tool.breadcrumbs ) 
    #end
  #end
#end
#foreach ( $site in $tabsSites.tabsSites)
  #if (${site.isCurrentSite} and  $site.isChild )
    #set ($portalPwd = $site.pwd)
  #end
#end
#set ( $siteTab = 0 )
<!-- START from NEO includeTabs.vm -->
			<!-- start includeTabs -->
			<div class="${tabsCssClass}">
				<div id="siteNav">
					<!-- login component -->
					<div id="mastLogin">
					#if (!${loginTopLogin})
						<div id="loginLinks">
						#if (${tabsSites.profileToolUrl})
<a href="${tabsSites.profileToolUrl}?sakai_nav_minimized=true">
						#end
						#if (${displayUserloginInfo})
							<span id="loginUser">${loginUserDispName} (${loginUserDispId})</span>
						#end						
						#if (${tabsSites.profileToolUrl})
</a>
						#end
						#if (${loginHasImage1}) 
							<a href="${loginLogInOutUrl}" title="${loginMessage}" id="loginLink1" ><img src="${loginImage1}" alt="${loginMessage}"/></a>
						#else
							<a href="${loginLogInOutUrl}" title="${loginMessage}" id="loginLink1" >${loginMessage}</a>
						#end
						#if (${loginHasLogInOutUrl2})
							#if (${loginHasImage2}) 
							<a href="${loginLogInOutUrl2}" title="${loginMessage2}" id="loginLink2" ><img src="${loginImage2}" alt="${loginMessage2}"/></a>
							#else
							<a href="${loginLogInOutUrl2}" title="${loginMessage2}" id="loginLink2" >${loginMessage2}</a>
							#end
						#end
						</div>
					#else
						<form id="loginForm" method="post" action="${loginPortalPath}/xlogin" enctype="application/x-www-form-urlencoded">
							<label for="eid">${loginEidWording}</label>
							<input name="eid" id="eid" type="text" />
							<label for="pw">${loginPwWording}</label>
							<input name="pw" type="password" id="pw" />
							<input name="submit" type="submit" id="submit" value="${loginWording}" />
							<script type="text/javascript" language="JavaScript">
								document.forms[0].eid.focus();
							</script>
						</form>
					#end
					</div>
					<!-- end login component -->
					<div id="linkNav">



						<a id="sitetabs" class="skip" name="sitetabs"></a>
							<h1 class="skip">${rloader.sit_worksiteshead}</h1>
<ul class="topnav" role="navigation">
						#foreach ( $site in $tabsSites.tabsSites ) 
							#if (${site.isCurrentSite})
								#if (${site.isMyWorkspace})
<li class="nav-selected nav-menu"><a href="#"><span>${rloader.sit_mywor}</span></a>
								#else
<li class="nav-selected nav-menu"><a href="#"><span>${site.siteTitle}</span></a>
								#end
							#else
								#if (${site.isMyWorkspace})
<li class="nav-menu"><a href="${site.siteUrl}" title="${rloader.sit_mywor}"><span>${rloader.sit_mywor}</span></a>
								#else
<li class="nav-menu"><a href="${site.siteUrl}" title="${site.siteTitle}"><span>${site.siteTitle}</span></a>
								#end
							#end
<ul class="nav-submenu subnav">
#set ( $pageCount = 0 )
    #foreach ( $page in $site.sitePages.pageNavTools ) 
        #set ($pageCount =$pageCount + 1)       
        #if (${page.isPage} && $pageCount < 100 )
<li class="submenuitem"><span><a href="${page.pageRefUrl}" title="${page.description}" class="${page.menuClass}">${page.pageTitle}</a></span></li>
        #end
    #end
</ul>
</li>
						#end

<li class="more-tab"><a href="#" onclick="return dhtml_view_sites();" title="${rloader.sit_more}"><span>-Active Sites-</span></a></li>
#set ( $siteTab = 1 )
						#if ($tabsSites.tabsMoreSitesShow && $useDHTMLMore && $siteTab == 0)
							<li class="more-tab"><a href="#" onclick="return dhtml_more_tabs();" title="${rloader.sit_more}"><span class="outer"><span class="inner">${rloader.sit_more_tab}</span></span></a></li>
						#end
						</ul>
					</div> <!-- /linkNav -->

					#if ($tabsSites.tabsMoreSitesShow && !$useDHTMLMore && $siteTab == 0)
					<div id="selectNav">
						<span class="skip">${rloader.sit_selectmessage}</span>
<!--
						<select onchange="if (this.options[this.selectedIndex].value != '') { parent.location = this.options[this.selectedIndex].value; } else { this.selectedIndex = 0; }">
							<option value="" selected="selected">${rloader.sit_more}</option>
						#foreach( $site in $tabsSites.tabsMoreSites )
							<option title="${site.siteTitle}" value="${site.siteUrl}">${site.siteTitle}</option> 
						#end	
						</select>
-->
					</div>
					#end
					#if ($viewAsStudentLink)
					<div id="roleSwitch">
						#if ($roleSwitchState)
							<a href="$switchRoleUrl"  id="roleSwitchAnchor">${rloader.rs_exitRoleSwap} $roleUrlValue ${rloader.rs_view}</a>
						#else
							#if ($roleswapdropdown)
							    <label for ="roleSwitchSelect">${rloader.rs_viewSiteAs}</label><a href="$switchRoleUrl"></a>
		                        <select id="roleSwitchSelect" onchange="if (this.options[this.selectedIndex].value != '') { parent.location = this.options[this.selectedIndex].value; } else { this.selectedIndex = 0; }"> 	 
		                        	<option value="" selected="selected">${rloader.rs_selectRole}</option> 	 
		                        #foreach( $role in $siteRoles) 	 
		                            <option value="$switchRoleUrl$role$panelString">$role</option> 	 
		                        #end 	 
		                        </select>
		                    #else
								<a href="$switchRoleUrl" id="roleSwitchAnchor">${rloader.rs_enterRoleSwap} $roleUrlValue ${rloader.rs_view}</a>
							#end
						#end
					</div>
					#end
					#if ($tabsAddLogout)
					<div class="galleryLogin">
						<a href="$tabsLogoutUrl">${rloader.sit_log}</a>
					</div>
				</div> <!-- /siteNav -->
					#else
				</div>
				<div class="divColor" id="tabBottom">
				</div>
					#end	


#if ( $siteTab == 1 )
<div id="selectSite" style="display:none">
         <div id="otherSiteSearch">
         	<label for="txtSearch">Search</label> <input type="text" id="txtSearch" name="txtSearch" maxlength="50" />
	        <a id="imgSearch" href="#"><img src="/portal/styles/neotmp/images/cancel.png" alt="Cancel Search" title="Cancel Search" /></a>
			<span id="noSearchResults" style="display:none">No search results found</span>
     	</div>
     	<ul id="otherSiteList">
						#foreach ( $site in $tabsSites.tabsSites ) 
								#if (${site.isMyWorkspace})
								#else
							<li><a href="${site.siteUrl}" title="${site.fullTitle}"><span>${site.fullTitle}</span></a></li>
								#end
						#end
						#foreach( $site in $tabsSites.tabsMoreSites )
							<li><a href="${site.siteUrl}" title="${site.fullTitle}"><span>${site.fullTitle}</span></a></li>
						#end	
      </ul>

#*
     	<table id="tblSearch" cellpadding="2" cellspacing="0" border="1" style="width:500px;">
						#foreach ( $site in $tabsSites.tabsSites ) 
								#if (${site.isMyWorkspace})
								#else
							<tr><td><a href="${site.siteUrl}" title="${site.fullTitle}"><span>${site.fullTitle}</span></a></td></tr>
								#end
						#end
						#foreach( $site in $tabsSites.tabsMoreSites )
							<tr><td><a href="${site.siteUrl}" title="${site.fullTitle}"><span>${site.fullTitle}</span></a></td></tr>
						#end	
      </table>
*# 
    <script language="javascript" type="text/javascript">
			
         // case insensitive version of :contains
         jQuery.extend(
            jQuery.expr[':'], {
                Contains: "jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0"
            }
         );
  
         jQuery(document).ready(function() {
			var siteTitle = ($('.nav-selected span:first').text())
			$('.portletTitle h2').prepend(siteTitle + ': ' )
             jQuery('#imgSearch').hide();
             jQuery('#imgSearch').click(function() {
                 resetSearch();
             });
  
             jQuery('#txtSearch').keyup(function(event) {
             if (event.keyCode == 27) {
                     resetSearch();
                 }
             });
  
             jQuery('#txtSearch').keyup(function() {
                  if (jQuery('#txtSearch').val().length > 2) {
                     jQuery('#otherSiteList li').hide();
                     // jQuery('#otherSiteList li:first').show();
                     jQuery('#otherSiteList li a:Contains(\'' + jQuery('#txtSearch').val() + '\')').parent().show();
                     jQuery('#imgSearch').fadeIn('slow');
                 }
                 if (jQuery('#txtSearch').val().length == 0) {
                     resetSearch();
                 }
  
                 // Should be <=1 if there is a header line
                 if (jQuery('#otherSiteList li:visible').length < 1) {
                     jQuery('.norecords').remove();
                     jQuery('#otherSiteSearch #noSearchResults').fadeIn('slow');
                 }
             });
         });
  
function resetSearch() {
             jQuery('#txtSearch').val('');
             jQuery('#otherSiteList li').show();
             jQuery('#noSearchResults').fadeOut();
             jQuery('#imgSearch').fadeOut();
             jQuery('#txtSearch').focus();
         }


jQuery(document).ready(function() {
  var toggle = function(direction, display) {
    return function() {
      var self = this;
      var ul = jQuery("ul", this);
      if( ul.css("display") == display && !self["block" + direction] ) {
        self["block" + direction] = true;
        ul["slide" + direction]("slow", function() {
          self["block" + direction] = false;
        });
      }
    };
  }
  // jQuery("li.nav-menu").hover(toggle("Down", "none"), toggle("Up", "block"));
  // jQuery("li.nav-menu ul").hide();
});

jQuery(document).ready(function(){
	jQuery("ul.subnav").parent().append('<span class="drop" tabindex="-1"></span>'); 
	$("ul.subnav").each(function(){
		$(this).children('li:last').addClass('lastMenuItem')
	});
	$('.lastMenuItem a').blur(function(e){
		jQuery(this).parents('ul.subnav').slideUp('fast').hide(); 
	});
	$('.topnav a').keydown(function(e){
	    if (e.keyCode == 40) {
			jQuery('#selectSite').hide();
			jQuery(this).parent().find("ul.subnav").slideDown('fast').show(); 
			jQuery(this).parent().find("ul.subnav a:first").focus(); 
	    }
	    if (e.keyCode == 38) {
			jQuery(this).parent().find("ul.subnav").slideUp('fast').hide(); 
	    }

	});

	jQuery("ul.topnav li span.drop").click(function() { 
		jQuery('#selectSite').hide();

		jQuery(this).parent().find("ul.subnav").slideDown('fast').show(); 

		jQuery(this).parent().hover(function() {
		}, function(){
			jQuery(this).parent().find("ul.subnav").slideUp('slow'); 
		});

		}).hover(function() {
			jQuery(this).addClass("subhover"); //On hover over, add class "subhover"
		}, function(){	//On Hover Out
			jQuery(this).removeClass("subhover"); //On hover out, remove class "subhover"
	});

});

</script>
</div>
#else
				#if ($useDHTMLMore)
				<div id="selectNav" style="display:none">
					<div>
						<span class="skip">${rloader.sit_selectmessage}</span>

					#foreach( $termKey in $tabsSites.tabsMoreSortedTermList)
						<div class="termContainer">
   						#if ( !$termKey || $termKey == "" )
							<h4>${rloader.sit_notermkey}</h4>
						#else
							<h4>$termKey</h4>
						#end
							<ul>
						#foreach( $site in $tabsSites.tabsMoreTerms.get($termKey))
							#if (${site.isMyWorkspace})
								<li><a href="${site.siteUrl}" title="${rloader.sit_mywor}">
									<span>${rloader.sit_mywor}</span>
								</a></li>
							#else
								<li><a href="${site.siteUrl}" title="${site.siteTitle}">
									<span>${site.siteTitle}</span>
								</a></li>
							#end
						#end
							</ul>
						</div> <!-- /termContainer -->
					#end
						<div id="more_tabs_instr">${rloader.sit_moretab_inst}</div>
					</div> <!-- /  -->
				</div> <!-- /selectNav -->
				#end
#end
			</div>
			 <!-- /tabsCssClass -->

<!-- end includeTabs -->
<!-- END from includeTabs.vm -->
