##
## emit the top of the page 
##
##------------------------------------------------------------------------------------------
#macro( start_response  )
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="${pageSkinRepo}/${pageSkin}/portal.css" type="text/css" rel="stylesheet" media="all" />
<!-- this caises problems for layout nneds investihating -->
    <link href="/portal/styles/portalstyles.css" type="text/css" rel="stylesheet" media="all" />
<!--[if gte IE 5]><![if lt IE 7]>
    <link href="/portal/styles/portalstyles-ie5.css" type="text/css" rel="stylesheet" media="all" />
<![endif]><![endif]-->
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <title>${pageTitle}</title>
    <script type="text/javascript" language="JavaScript" src="${pageScriptPath}/headscripts.js"></script>
    <script type="text/javascript" language="JavaScript" src="/library/scripts/portalscripts.js"></script>
</head>
<body class="portalBody">
<div class="skinselection" >
<form id="skinselect" action="#" method="GET" name="skinselect">
	<select name="portalskin" id="portalskin" onchange="skinselect.submit();" >
#foreach ($skin in $pageSkins) 
#if (  ${skin.name} == $pageCurrentSkin )
   		<option value="${skin.name}" selected="selected" >${skin.display}</option>
#else
   		<option value="${skin.name}" >${skin.display}</option>
#end
#end
	</select>
</form>
</div>
#if ( $pageTop )
	<script type="text/javascript" language="JavaScript">
	var sakaiPortalWindow = "";
	</script>
#end
#end
##
## emit the bottom of the page
##
#macro( end_response  )
	</body>
</html>
#end
##------------------------------------------------------------------------------------------
##
## includeTool
##
##------------------------------------------------------------------------------------------
##		toolMap.put("toolUrl", toolUrl);
##		toolMap.put("toolPlacementIDJS", Web.escapeJavascript("Main"
##				+ placement.getId()));
##		toolMap.put("toolResetActionUrl", resetActionUrl);
##		toolMap.put("toolTitle", titleString);
##		toolMap.put("toolShowResetButton", Boolean.valueOf(showResetButton));
##		toolMap.put("toolShowHelpButton", Boolean.valueOf(showHelpButton));
##		toolMap.put("toolHelpActionUrl", helpActionUrl);
##		toolMap.put("toolContentPortTitle", Web.escapeHtml(rb
##				.getString("sit.contentporttit")));
##
#macro( includeTool $toolPlacement )
#if (${toolPlacement.hasRenderResult})
<div class="portlet">
	<div class="portletTitleWrap">
		<div class="portletTitle">
			<div class="title">
#if (${toolPlacement.toolShowResetButton})
                <a href="${toolPlacement.toolResetActionUrl}" target="${toolPlacement.toolPlacementIDJS}" title="${sitReset}">
                        <img src="/library/image/transparent.gif" alt="${sitReset}" border="1" />
                </a>
#end
				<h2>${toolPlacement.toolRenderResult.getTitle()}</h2>
			</div>
			<div class="action">
#if (${toolPlacement.toolShowHelpButton})
		<a accesskey="h" href="${toolPlacement.toolHelpActionUrl}" title="${sitHelp}" 
		 target="_blank" onclick="openWindow('${toolPlacement.toolHelpActionUrl}', 'Help',
		  'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); return false">
			<img src="/library/image/transparent.gif"  alt="${sitHelp}" border="0" />
		</a>
#end
			</div>
		</div>
	</div>

	<div class="portletMainWrap">
	    ${toolPlacement.toolRenderResult.getContent()}
	</div>
</div>
#else
<div class="portlet">
	<div class="portletTitleWrap">
		<div class="portletTitle">
			<div class="title">
#if (${toolPlacement.toolShowResetButton})
                <a href="${toolPlacement.toolResetActionUrl} target="${toolPlacement.toolPlacementIDJS}" title="${sitReset}">
                        <img src="/library/image/transparent.gif" alt="${sitReset}" border="1" />
                </a>
#end	
				<h2>${toolPlacement.toolTitle}</h2>
			</div>
			<div class="action">
#if (${toolPlacement.toolShowHelpButton})
		<a accesskey="h" href="${toolPlacement.toolHelpActionUrl}" title="${sitHelp}" 
		 target="_blank" onclick="openWindow('${toolPlacement.toolHelpActionUrl}', 'Help',
		  'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); return false">
			<img src="/library/image/transparent.gif"  alt="${sitHelp}" border="0" />
		</a>
#end
			</div>
		</div>
	</div>

	<div class="portletMainWrap">
		<iframe	name="${toolPlacement.toolPlacementIDJS}" id="${toolPlacement.toolPlacementIDJS}" title="${toolPlacement.toolTitle}" 
			class ="portletMainIframe"
			height="50"
			width="100%"
			frameborder="0"
			marginwidth="0"
			marginheight="0"
			scrolling="auto"	
			src="${toolPlacement.toolUrl}?panel=Main">
		</iframe>
	</div>
</div>
#end
#end
##------------------------------------------------------------------------------------------
##
## includeLogo
##
##------------------------------------------------------------------------------------------
##		vcontext.put("logoSkin", skin);
##		vcontext.put("logoSkinRepo", skinRepo);
##		String siteType = calcSiteType(siteId);
##		String cssClass = (siteType != null) ? siteType
##				: "undeterminedSiteType";
##		vcontext.put("logoSiteType", siteType);
##		vcontext.put("logoSiteClass", cssClass);
##
#macro( includeLogo  ) 
<div id="siteNavWrapper" class="${logoSiteClass}">
	<div id="mastHead">
		<div id="mastLogo">
			<img title="Logo" alt="Logo" src="${logoSkinRepo}/${logoSkin}/images/logo_inst.gif" />
		</div>
		<div id="mastBanner">
			<img title="Banner" alt="Banner" src="${logoSkinRepo}/${logoSkin}/images/banner_inst.gif" />
		</div>
		<div id="mastLogin">
#includeLogin()
		</div>
	</div>
</div>
#end
##------------------------------------------------------------------------------------------
##
## includeLogin
##
##------------------------------------------------------------------------------------------	
##			vcontext.put("loginTopLogin", Boolean.valueOf(topLogin));
##			vcontext.put("loginLogInOutUrl", logInOutUrl);
##			vcontext.put("loginMessage", message);
##			vcontext.put("loginImage1", image1);
##			vcontext.put("loginLogInOutUrl2", logInOutUrl2);
##			vcontext.put("loginMessage2", message2);
##			vcontext.put("loginImage12", image2);
##			vcontext.put("loginPortalPath", ServerConfigurationService
##					.getString("portalPath"));
##			vcontext.put("loginEiWording", eidWording);
##			vcontext.put("loginPwWording", pwWording);
##			vcontext.put("loginWording", loginWording);
#macro( includeLogin  )
#if (!${loginTopLogin})
	<div id="loginLinks">
		<a href="${loginLogInOutUrl}" target="_parent" title="${loginMessage}">
#if (${loginHasImage1}) 
			<img src="${loginImage1}"/>
#else
			${loginMessage}
#end
		</a>
#if (${loginHasLogInOutUrl2})
		<a href="${loginLogInOutUrl2}" target="_parent" title="${loginMessage2}">
#if (${loginHasImage2}) 
			<img alt="${loginMessage2}" src="${loginImage2}"/>
#else
			${loginMessage2}
#end
		</a>
#end
	</div>
#else
	<form id="loginForm" method="post" action="${loginPortalPath}/xlogin" enctype="application/x-www-form-urlencoded" target="_parent">
		<label for="eid">${loginEidWording}</label>
		<input name="eid" id="eid" type="text" />
		<label for="pw">${loginPwWording}</label>
		<input name="pw" type="password" id="pw" />
		<input name="submit" type="submit" id="submit" value="${loginWording}" />
		<script type="text/javascript" language="JavaScript">
			document.forms[0].eid.focus();
		</script>
	</form>
#end
#end
##------------------------------------------------------------------------------------------
##
##includeTabs
##
##		rcontext.put("tabsCssClass",cssClass);
##		rcontext.put("tabsSitWorksiteHead",Web.escapeHtml(rb.getString("sit.worksiteshead")));
##		rcontext.put("tabsCurMyWorkspace",Boolean.valueOf(curMyWorkspace));
##		rcontext.put("tabsSitMyWorkspace",rb.getString("sit.mywor"));
##		rcontext.put("tabsSiteUrl",mySiteUrl);
##		rcontext.put("tabsSitWorksite",Web.escapeHtml(rb.getString("sit.worksite")));
##			m.put("isCurrentSite",Boolean.valueOf(s.getId().equals(siteId)));
##			m.put("siteTitle",Web.escapeHtml(s.getTitle()));
##			m.put("siteUrl",Web.escapeHtml(s.getTitle()));
##		rcontext.put("tabsSites",l);		
##		rcontext.put("tabsHasExtraTitle",Boolean.valueOf(extraTitle != null));
##			rcontext.put("tabsExtraTitle",Web.escapeHtml(extraTitle));
##			
##			rcontext.put("tabsSitSelectMessage",Web.escapeHtml(rb.getString("sit.selectmessage")));
##			rcontext.put("tabsSitMore",Web.escapeHtml(rb.getString("sit.more")));
##				m.put("title",Web.escapeHtml(s.getTitle()));
##				m.put("url",siteUrl);
##			rcontext.put("tabsMoreSites",l);
##
##		rcontext.put("tabsAddLogout",Boolean.valueOf(addLogout));
##			rcontext.put("tabsLogoutUrl",logoutUrl);
##			rcontext.put("tabsSitLog",Web.escapeHtml(rb.getString("sit.log")));
##------------------------------------------------------------------------------------------
#macro( includeTabs  )
<!-- start includeTabs -->
<div class="${tabsCssClass}">
	<div id="siteNav">
		<div id="linkNav">
			<a id="sitetabs" class="skip" name="sitetabs"></a>
			<h1 class="skip">${tabsSitWorksiteHead}</h1>
			<ul id="siteLinkList">
#if (${siteNavLoggedIn})
#if ($tabsCurMyWorkspace)
				<li class="selectedTab"><a href="#"><span>${tabsSitMyWorkspace}</span></a></li>
#else
				<li><a href="${tabsSiteUrl}" target="_parent" title="${tabsSitMyWorkspace}"><span>${tabsSitMyWorkspace}</span></a></li>
#end
#end
#foreach ( $site in $tabsSites ) 
#if (${site.isCurrentSite})
				<li class="selectedTab"><a href="#"><span>${site.siteTitle}</span></a></li>
#else
				<li><a href="${site.siteUrl}" target="_parent" title="${site.siteTitle} ${tabsSitMyWorkspace}">
					<span>${site.siteTitle}</span>
				</a></li>
#end
#end
#if ($tabsHasExtraTitle)
				<li class="selectedTab"><a><span>${tabsExtraTitle}</span></a></li>
#end
				<li style="display:none;border-width:0" class="fixTabsIE">
					<a href="javascript:void(0);">#x20;</a>
				</li>
			</ul>
		</div>
#if ($tabsMoreSitesShow)
		<div id="selectNav">
			<span class="skip">${tabsSitSelectMessage}</span>
			<select onchange="if (this.options[this.selectedIndex].value != '') { parent.location = this.options[this.selectedIndex].value; } else { this.selectedIndex = 0; }">
				<option value="" selected="selected">${tabsSitMore}</option>
#foreach( $site in $tabsMoreSites )
				<option title="${site.siteTitle}" value="${site.siteUrl}">${site.siteTitle}</option> 
#end	
			</select>
		</div>
#end
#if ($tabsAddLogout)
		<div class="galleryLogin">
			<a href="$tabsLogoutUrl" target="_parent">$tabsSitLog</a>
		</div>
	</div>

#else
	</div>
	<div class="divColor" id="tabBottom">
	</div>
#end	
</div>
<!-- end includeTabs -->
#end
##------------------------------------------------------------------------------------------
##
## includeWorksite
##
##------------------------------------------------------------------------------------------
#macro( includeWorksite  ) 
#includePage()
#end
##------------------------------------------------------------------------------------------
##
## -- from includePageNav
##------------------------------------------------------------------------------------------
##
##		rcontext.put("pageNavPublished",Boolean.valueOf(published));
##		rcontext.put("pageNavType",type);
##		rcontext.put("pageNavIconUrl",iconUrl);
##		rcontext.put("pageNavSitToolsHead",Web.escapeHtml(rb.getString("sit.toolshead")));
##			m.put("current",Boolean.valueOf(current));
##			m.put("ispopup",Boolean.valueOf(p.isPopUp()));
##			m.put("pagePopupUrl",pagePopupUrl);
##			m.put("pageIdWeb",Web.escapeUrl(p.getId()));
##			m.put("jsPageTitle",Web.escapeJavascript(p.getTitle()));
##			m.put("htmlPageTitle",Web.escapeHtml(p.getTitle()));
##			m.put("pagerefUrl",pagerefUrl);
##		rcontext.put("pageNavTools",l);		
##		rcontext.put("pageNavShowHelp",Boolean.valueOf(showHelp));
##		rcontext.put("pageNavHelpUrl",helpUrl);
##
##		rcontext.put("pageNavSitPresenceTitle",Web.escapeHtml(rb.getString("sit.presencetitle")));
##		rcontext.put("pageNavSitPresenceFrameTitle",Web.escapeHtml(rb.getString("sit.presenceiframetit")));
##		rcontext.put("pageNavPresenceUrk",presenceUrl);
##		rcontext.put("pageNavSitContentshead",Web.escapeHtml(rb.getString("sit.contentshead")));
##		
#macro( includePageNav   )
<!-- start includePageNav -->
	<div class="divColor" id="toolMenuWrap">
		<div id="worksiteLogo">
#if (!${pageNavPublished})
			<p id="siteStatus">unpublished site</p>
#end
#if ($pageNavType && $pageNavType != "project" )
			<p id="siteType">$pageNavType</p>
#end
#if ($pageNavIconUrl && $pageNavIconUrl != "")
			<img src="$pageNavIconUrl" border="0" alt="Worksite Logo" />
#end
		</div>
		<a id="totoolmenu" class="skip" name="totoolmenu"></a>
		<h1 class="skip">$pageNavSitToolsHead</h1>
		<div id="toolMenu">
			<ul>
#foreach( $page in $pageNavTools )
#if (${page.current})
				<li class="selectedTool"><a class="selected" href="#">
#else
#if (${page.ispopup})
				<li><a href="javascript:;" onclick="window.open('${page.pagePopupUrl}${page.pageIdWeb}','${page.jsPageTitle}','resizable=yes,toolbar=no,scrollbars=yes, width=800,height=600')">
#else
				<li><a href="${page.pagerefUrl}" >
#end
#end
						<span>${page.htmlPageTitle}</span>
					</a>
				</li>
#end
#if (${pageNavShowHelp})
				<li>
				<a  accesskey="6" href="${pageNavHelpUrl}" target="_blank" 
					onclick="openWindow('${pageNavHelpUrl}', 
					'Help', 'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); 
					return false">"
					<span>${sitHelp}</span>
				</a>
				</li>
#end
			</ul>
		</div>
#if (${pageNavShowPresenceLoggedIn})
		<div id="presenceWrapper">
			<div id="presenceTitle">${pageNavSitPresenceTitle}</div>
			<iframe name="presenceIframe" id="presenceIframe" title="${pageNavSitPresenceTitle}"
				frameborder="0" marginwidth="0" marginheight="0" scrolling="auto" src="${pageNavPresenceUrl}" >
			</iframe>
		</div>
#end
	</div>
	<h1 class="skip">${pageNavSitContentshead}</h1>
	<a id="tocontent" class="skip" name="tocontent"></a>
<!-- end includePageNav -->
#end		
##------------------------------------------------------------------------------------------
##
## from Include Page
## rcontext.put("pageWrapperClass", wrapperClass);
## rcontext.put("pageColumnLayout", Integer.valueOf(page.getLayout()));
## rcontext.put("pageColumn0Tools", toolList);
## rcontext.put("pageColumn1Tools", toolList);
##------------------------------------------------------------------------------------------
#macro( includePage   ) 	
<!-- start includePage -->		
<div id="container" $pageSiteType >
#includePageNav()
	<div id="$pageWrapperClass">
		<div id="$pageColumnLayout">
#foreach ( $tool in $pageColumn0Tools ) 
#includeTool($tool)
#end
		</div>
#if ($pageTwoColumn)
		<div id="col2of2">
#foreach ( $tool in $pageColumn1Tools ) 
#includeTool($tool)
#end
		</div>
#end
	</div>
	<div>
#includeBottom()
	</div>
</div>
<!-- end includePage -->		
#end
##------------------------------------------------------------------------------------------
##
## includeGalleryNav
##		rcontext.put("galleryHasAccessibilityURL", Boolean.valueOf((accessibilityURL != null && accessibilityURL != "")));
##		rcontext.put("galleryAccessibilityURL", accessibilityURL);
##		rcontext.put("gallarySitAccessibility", Web.escapeHtml(rb
##				.getString("sit.accessibility")));
##		rcontext.put("gallarySitJumpcontent", Web.escapeHtml(rb
##				.getString("sit.jumpcontent")));
##		rcontext.put("gallarySitJumptools", Web.escapeHtml(rb
##				.getString("sit.jumptools")));
##		rcontext.put("gallarySitJumpworksite", Web.escapeHtml(rb
##				.getString("sit.jumpworksite")));
##		rcontext.put("gallaryLoggedIn", Boolean.valueOf(loggedIn));
##
##------------------------------------------------------------------------------------------
#macro( includeGalleryNav  )
<!-- start includeGalleryNav -->
<div id="portalOuterContainer">
	<div id="portalContainer">
		<div id="skipNav">
#if ($galleryHasAccessibilityURL)
			<a href="$galleryAccessibilityURL" class="skip" title="$gallarySitAccessibility" accesskey="0">$gallarySitAccessibility</a>
#end
			<a href="#tocontent"  class="skip" title="$gallarySitJumpcontent" accesskey="c">$gallarySitJumpcontent</a>
			<a href="#totoolmenu"  class="skip" title="$gallarySitJumptools" accesskey="l">$gallarySitJumptools</a>
			<a href="#sitetabs" class="skip" title="$gallarySitJumpworksite" accesskey="w">$gallarySitJumpworksite</a>
		</div>
#if (${gallaryLoggedIn})
		<div id="headerMax">
#includeTabs()
		</div>
#else
		<div id="headerMin">
#includeGalleryLogin()
			<div class="divColor" id="tabBottom"><br />
			</div>
		</div>
#end
#includePage()
	</div>
</div>
<!-- end includeGalleryNav -->
#end
##------------------------------------------------------------------------------------------
##
## includeGalleryLogin
##------------------------------------------------------------------------------------------
#macro( includeGalleryLogin  )
<!-- start includeGalleryLogin -->
<div class="siteNavBlock">	
	<table class="mast-head" cellpadding="0" cellspacing="0" border="0" width="100%" summary="Login Box" >
		<tr>
			<td class="right mast-head-r right">
#includeLogin()
			</td>
		</tr>
	</table>
</div>
<!-- end includeGalleryLogin -->
#end
##------------------------------------------------------------------------------------------
##
## includeSiteNav
##------------------------------------------------------------------------------------------
##        rcontext.put("siteNavHasAccessibilityURL",Boolean.valueOf((accessibilityURL != null && accessibilityURL != "")));
##        rcontext.put("siteNavAccessibilityURL",accessibilityURL);
##        rcontext.put("siteNavSitAccessability",Web.escapeHtml(rb.getString("sit.accessibility")));
##        rcontext.put("siteNavSitJumpContent",Web.escapeHtml(rb.getString("sit.jumpcontent")));
##        rcontext.put("siteNavSitJumpTools",Web.escapeHtml(rb.getString("sit.jumptools")));
##        rcontext.put("siteNavSitJumpWorksite",Web.escapeHtml(rb.getString("sit.jumpworksite")));
##        
##        rcontext.put("siteNavLoggedIn",Boolean.valueOf(loggedIn));
#macro( includeSiteNav  )
<!-- start includeSiteNav -->
<div id="portalOuterContainer">
	<div id="portalContainer">
		<div id="skipNav">
#if ($siteNavHasAccessibilityURL)
			<a href="$siteNavAccessibilityURL" class="skip" title="$siteNavSitAccessability" accesskey="0">
				$siteNavSitAccessability
			</a>
#end

			<a href="#tocontent"  class="skip" title="$siteNavSitJumpContent" accesskey="c">
			$siteNavSitJumpContent
			</a>
			<a href="#totoolmenu"  class="skip" title="$siteNavSitJumpTools" accesskey="l">
				$siteNavSitJumpTools
			</a>
			<a href="#sitetabs" class="skip" title="$siteNavSitJumpWorksite" accesskey="w">
				$siteNavSitJumpWorksite
			</a>
		</div>
#if (${tabsSites})
		<div id="headerMax">
#includeLogo()
#includeTabs()
		</div>
#else
		<div id="headerMin">
#includeLogo()
			<div class="divColor" id="tabBottom">
				<br />
			</div>
		</div>
#end
#includePage()
	</div>
</div>
<!-- end includeSiteNav -->
#end



#macro( includeBottom )
<div id="footer">
	<div class="footerExtNav" align="center">
		|
#foreach ( $bn in $bottomNav )
		${bn}  | 
#end
	</div>
	<div id="footerInfo">
#foreach ( $pb in $bottomNavPoweredBy )
		<span class="skip">${bottomNavSitNewWindow}</span>	
		<a href="${pb.poweredByUrl}" target="_blank">
				<img border="0" src="${pb.poweredByImage}" alt="${pb.poweredByAltText}" /></a>
#end
	</div>
	<div class="sakaiCopyrightInfo">${bottomNavCopyright}<br />
	${bottomNavService} - ${bottomNavServiceVersion} - Sakai ${bottomNavSakaiVersion} - Server ${bottomNavServer}
	</div>
</div>
#end
